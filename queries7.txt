create database mydb;
use mydb;

-- Drop tables if they exist
DROP TABLE IF EXISTS Stud_Marks;
DROP TABLE IF EXISTS Result;

-- Create Stud_Marks table
CREATE TABLE Stud_Marks (
    Name VARCHAR(50),
    Total_Marks INT
);

-- Create Result table
CREATE TABLE Result (
    Roll_No INT,
    Name VARCHAR(50),
    Class VARCHAR(50)
);

-- Insert sample data
INSERT INTO Stud_Marks VALUES ('Alice', 1050);
INSERT INTO Stud_Marks VALUES ('Bob', 950);
INSERT INTO Stud_Marks VALUES ('Charlie', 880);
INSERT INTO Stud_Marks VALUES ('David', 750);


-- Procedure for assigning class
DELIMITER $$

CREATE PROCEDURE proc_Grade(
    IN p_student_name VARCHAR(50),
    IN p_total_marks INT,
    IN p_roll_no INT
)
BEGIN
    DECLARE v_class VARCHAR(50);

    IF p_total_marks BETWEEN 990 AND 1500 THEN
        SET v_class = 'Distinction';
    ELSEIF p_total_marks BETWEEN 900 AND 989 THEN
        SET v_class = 'First Class';
    ELSEIF p_total_marks BETWEEN 825 AND 899 THEN
        SET v_class = 'Higher Second Class';
    ELSE
        SET v_class = 'Pass Class';
    END IF;

    INSERT INTO Result (Roll_No, Name, Class)
    VALUES (p_roll_no, p_student_name, v_class);

    SELECT CONCAT('Student ', p_student_name, ' (Roll No ', p_roll_no, ') categorized as: ', v_class) AS Message;
END $$

DELIMITER ;


-- Procedure to process all students
DELIMITER $$

CREATE PROCEDURE Process_Students()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE v_name VARCHAR(50);
    DECLARE v_marks INT;
    DECLARE v_roll INT DEFAULT 0;

    DECLARE cur CURSOR FOR SELECT Name, Total_Marks FROM Stud_Marks;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;

    OPEN cur;

    read_loop: LOOP
        FETCH cur INTO v_name, v_marks;
        IF done THEN
            LEAVE read_loop;
        END IF;

        SET v_roll = v_roll + 1;
        CALL proc_Grade(v_name, v_marks, v_roll);
    END LOOP;

    CLOSE cur;

    SELECT 'Student categorization complete.' AS Message;
END $$

DELIMITER ;


-- ✅ Run the processing
CALL Process_Students();


-- ✅ Display final result table
SELECT * FROM Result;
