create database mydb;
use mydb;

CREATE TABLE Library (
    Book_ID INT PRIMARY KEY,
    Book_Name VARCHAR(100),
    Author VARCHAR(100),
    Price DECIMAL(10,2)
);

CREATE TABLE Library_Audit (
    Audit_ID INT AUTO_INCREMENT PRIMARY KEY,
    Book_ID INT,
    Book_Name VARCHAR(100),
    Author VARCHAR(100),
    Price DECIMAL(10,2),
    Operation_Type VARCHAR(10),   -- 'UPDATE' or 'DELETE'
    Operation_Date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Trigger for UPDATE
DELIMITER //
CREATE TRIGGER trg_library_before_update
BEFORE UPDATE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (Book_ID, Book_Name, Author, Price, Operation_Type)
    VALUES (OLD.Book_ID, OLD.Book_Name, OLD.Author, OLD.Price, 'UPDATE');
END //
DELIMITER ;

-- Trigger for DELETE
DELIMITER //
CREATE TRIGGER trg_library_before_delete
BEFORE DELETE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (Book_ID, Book_Name, Author, Price, Operation_Type)
    VALUES (OLD.Book_ID, OLD.Book_Name, OLD.Author, OLD.Price, 'DELETE');
END //
DELIMITER ;
